FROM ubuntu AS builder

COPY files/build.sh /opt/
COPY files/CloudreveController.java /opt/

RUN chmod +x /opt/build.sh \
    && /bin/bash /opt/build.sh

FROM ubuntu

COPY --from=builder /opt/kkfileview.tar.gz /opt/kkfileview.tar.gz
COPY files/install.sh /opt/
COPY files/start.sh /opt/

RUN chmod +x /opt/install.sh \
    && /bin/bash /opt/install.sh \
    && apt-get clean \
    && rm -rf /var/lib/apt/lists/*

WORKDIR /opt/kkfileview/server/src/main/bin

ENTRYPOINT ["/bin/bash", "start.sh"]
