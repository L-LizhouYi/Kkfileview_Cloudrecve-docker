package cn.keking.web.controller;

import org.springframework.http.HttpStatus;
import org.springframework.http.ResponseEntity;
import org.springframework.web.bind.annotation.GetMapping;
import org.springframework.web.bind.annotation.RequestParam;
import org.springframework.web.bind.annotation.RestController;
import org.springframework.web.servlet.view.RedirectView;

import java.nio.charset.StandardCharsets;
import java.util.Base64;

@RestController
public class CloudreveController {

    @GetMapping("/CloudrevePreview")
    public Object redirectToOnlinePreview(
            @RequestParam(required = false) String fileurl,
            @RequestParam(required = false) String filename) {

        if (fileurl == null || filename == null) {
            return ResponseEntity.status(HttpStatus.OK)
                    .body("Cloudreve API Success");
        }

        String concatenatedString = fileurl + "&fullfilename=" + filename;
        String base64EncodedString = Base64.getEncoder().encodeToString(concatenatedString.getBytes(StandardCharsets.UTF_8));
        String redirectUrl = "/onlinePreview?url=" + base64EncodedString;

        return new RedirectView(redirectUrl);
    }
}
